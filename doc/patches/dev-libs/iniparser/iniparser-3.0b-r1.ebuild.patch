--- /auto/portage/dev-libs/iniparser/iniparser-3.0b-r1.ebuild	2010-04-11 04:38:32.000000000 -0400
+++ ./dev-libs/iniparser/iniparser-3.0b-r1.ebuild	2010-11-22 23:15:02.080266195 -0500
@@ -19,19 +19,20 @@
 
 S="${WORKDIR}/${MY_P}"
 
-src_unpack() {
-	unpack ${A}
+src_prepare() {
 	epatch "${FILESDIR}/${P}-fix-set-functions.patch"
 }
 
-src_compile() {
+src_configure() {
 	echo "CFLAGS: ${CFLAGS}"
 	sed -i \
 		-e "s|\(CFLAGS  =\) -O2|\1 ${CFLAGS}|" \
 		-e "s|\(LDFLAGS =\)|\1 ${LDFLAGS}|" \
 		-e "s|/usr/lib|/usr/$(get_libdir)|" \
 		Makefile || die "sed failed"
+}
 
+src_compile() {
 	emake CC=$(tc-getCC) AR="$(tc-getAR)" || die "emake failed"
 }
 

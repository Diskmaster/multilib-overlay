--- /auto/portage/dev-libs/nspr/nspr-4.8.4.ebuild	2010-09-20 16:05:34.000000000 -0400
+++ ./dev-libs/nspr/nspr-4.8.4.ebuild	2010-11-23 11:16:12.499272370 -0500
@@ -15,9 +15,7 @@
 KEYWORDS="alpha amd64 arm hppa ia64 ~mips ppc ppc64 sparc x86 ~x86-fbsd"
 IUSE="debug"
 
-src_unpack() {
-	unpack ${A}
-	cd "${S}"
+src_prepare() {
 	mkdir build inst
 	epatch "${FILESDIR}"/${PN}-4.8-config.patch
 	epatch "${FILESDIR}"/${PN}-4.6.1-config-1.patch
@@ -30,7 +28,7 @@
 		mozilla/nsprpub/config/rules.mk
 }
 
-src_compile() {
+src_configure() {
 	cd "${S}"/build
 
 	echo > "${T}"/test.c
@@ -47,6 +45,9 @@
 		$(use_enable debug) \
 		$(use_enable !debug optimize) \
 		${myconf} || die "econf failed"
+}
+
+src_compile() {
 	emake CC="$(tc-getCC)" CXX="$(tc-getCXX)" || die "failed to build"
 }
 

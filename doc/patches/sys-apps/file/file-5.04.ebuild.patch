--- /auto/portage/sys-apps/file/file-5.04.ebuild	2010-10-12 14:07:09.000000000 -0400
+++ ./sys-apps/file/file-5.04.ebuild	2010-10-13 21:52:36.532620987 -0400
@@ -22,4 +22,5 @@
 	unpack ${P}.tar.gz
-	cd "${S}"
+}
 
+src_prepare() {
 	epatch "${FILESDIR}"/${PN}-4.15-libtool.patch #99593
@@ -35,3 +36,3 @@
 
-src_compile() {
+src_configure() {
 	# file uses things like strndup() and wcwidth()
@@ -40,2 +41,5 @@
 	econf || die
+}
+
+src_compile() {
 	emake || die

--- /usr/portage/sys-fs/udev/udev-151-r4.ebuild	2010-07-21 22:39:05.000000000 -0500
+++ ./sys-fs/udev/udev-151-r4.ebuild	2010-07-23 05:05:00.779729301 -0500
@@ -26,3 +26,3 @@
 KEYWORDS="~alpha ~amd64 ~arm ~hppa ~ia64 ~m68k ~mips ~ppc ~ppc64 ~s390 -sh ~sparc x86"
-IUSE="selinux devfs-compat old-hd-rules -extras test"
+IUSE="selinux devfs-compat old-hd-rules -extras test introspection"
 
@@ -37,3 +37,4 @@
 	>=sys-apps/util-linux-2.16
-	>=sys-libs/glibc-2.9"
+	>=sys-libs/glibc-2.9
+	introspection? ( >=dev-libs/gobject-introspection-0.6.5 )"
 
@@ -140,5 +141,5 @@
 	fi
+}
 
-	cd "${S}"
-
+src_prepare() {
 	# patches go here...
@@ -194,3 +195,3 @@
 
-src_compile() {
+src_configure() {
 	filter-flags -fprefetch-loop-arrays
@@ -208,6 +209,3 @@
 		$(use_enable extras) \
-		--disable-introspection
-	# we don't have gobject-introspection in portage tree
-
-	emake || die "compiling udev failed"
+		$(use_enable introspection)
 }

#!/bin/sh

# patch-update - A quick version of refreshing a patch for a specific ebuild, use me with care. .ebuild extension auto-assumed. Intentionally dumb.
# $1 should be the full atom plus the ebuild without extension. e.g. www-client/mozilla-firefox/mozilla-firefox-3.6.7

PORTAGE_DIR="/auto/portage"

if [ ! -n "$1" ]
then
  	echo "Usage: `basename $0` category/package/package-version"
  	exit $E_BADARGS
fi  

if [ ! -e "${PORTAGE_DIR}/$1.ebuild" ]
then
	echo "ERROR: ${PORTAGE_DIR}/$1.ebuild must exist"
	exit $E_BADARGS
fi

cp ${PORTAGE_DIR}/$1.ebuild $1.ebuild

if [ -e "./doc/patches/$1.ebuild.patch" ]
then
	patch -p0 < "./doc/patches/$1.ebuild.patch"
fi

gedit $1.ebuild

mkdir `dirname doc/patches/$1`

diff -u ${PORTAGE_DIR}/$1.ebuild ./$1.ebuild > doc/patches/$1.ebuild.patch





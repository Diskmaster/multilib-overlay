#!/bin/bash 

echo_red() {
	echo -e "\033[1;31m$*\033[0m"
}

echo_green() {
	echo -e "\033[1;32m$*\033[0m"
}

echo_yellow() {
	echo -e "\033[1;33m$*\033[0m"
}

# bin/auto-sync-cfg should be in .gitignore.
# No, that's invalid. Use the user's home directory (or root if you are crazy.).
if [[ -f ~/auto-sync-cfg ]]; then
	echo_green "Passed auto-sync-cfg sanity check."
	source ~/auto-sync-cfg
else
	echo_red "Failed auto-sync-cfg sanity check, copying template to user home directory."
	cp -v bin/auto-sync-cfg.skel ~/auto-sync-cfg
	exit 1	
fi

ECLASS_LIST="$(find eclass -type f -not -wholename 'eclass/multilib-native.eclass' )"
[[ -n ${DEBUG} ]] && echo ${ECLASS_LIST}

for ECLASS in ${ECLASS_LIST}; do
	echo_yellow "\nworking on: ${ECLASS}"
	cp ${SOURCE_DIR}/${ECLASS} ${ECLASS}
	bash bin/add_lib32_usedeps ${ECLASS}
	if [[ -f ${PATCH_DIR}/${ECLASS}.patch ]]; then
		patch -p1 < ${PATCH_DIR}/${ECLASS}.patch
	else
		echo_red "${PATCH_DIR}/${ECLASS}.patch is not available"
	fi
	echo_green "finished working on: ${ECLASS}\n"
done


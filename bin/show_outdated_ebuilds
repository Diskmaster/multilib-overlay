#!/bin/bash

echo_red() {
	echo -e "\033[1;31m$*\033[0m"
}

echo_green() {
	echo -e "\033[1;32m$*\033[0m"
}

echo_yellow() {
	echo -e "\033[1;33m$*\033[0m"
}

# bin/auto-sync-cfg should be in .gitignore.
# No, that's invalid. Use the user's home directory (or root if you are crazy.).
# The auto-sync-cfg system should suffice here.
if [[ -f ~/auto-sync-cfg ]]; then
	echo_green "Passed auto-sync-cfg sanity check."
	source ~/auto-sync-cfg
else
	echo_red "Failed auto-sync-cfg sanity check, copying template to user home directory."
	cp -v bin/auto-sync-cfg.skel ~/auto-sync-cfg
	exit 1	
fi

#SOURCE_DIR=$1
#IGNORE_LIST=$2

#if [[ ! -d ${SOURCE_DIR} ]]; then
#	SOURCE_DIR=/usr/portage
#	IGNORE_LIST=$1
#fi

#if [[ ! -f ${IGNORE_LIST} ]]; then
#	IGNORE_LIST=doc/ignore_lists/portage
#fi

echo ebuild listed in ${IGNORE_LIST} are ignored
echo the following ebuild are not in ${SOURCE_DIR}

IGNORED_EBUILD="$(cat ${IGNORE_LIST})"

for EBUILD in $(find . -name "*.ebuild" -a -not -path "./main_tree*"); do
	if [[ ! -f ${SOURCE_DIR}/${EBUILD} ]]; then
		EBUILDS_NOT_IN_SOURCE="${EBUILDS_NOT_IN_SOURCE} ${EBUILD}"
	fi
done

for EBUILD in ${IGNORED_EBUILD}; do
#	EBUILDS_NOT_IN_SOURCE="${EBUILDS_NOT_IN_SOURCE/"${EBUILD}"/}"
	EBUILDS_NOT_IN_SOURCE=$(echo -e "${EBUILDS_NOT_IN_SOURCE}" | sed "s@${EBUILD}@@" )
done

EBUILDS_NOT_IN_SOURCE="$(tr ' ' '\n' <<< "${EBUILDS_NOT_IN_SOURCE}" | sort -u)"

echo -e "${EBUILDS_NOT_IN_SOURCE}"
